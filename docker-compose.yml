services:
  inngest-dev:
    image: inngest/inngest:latest
    command: ["inngest", "dev", "-u", "http://api:8000/api/inngest"]
    ports:
      - "8288:8288"
    environment:
      - INNGEST_DEV=1

  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    ports:
      - "8000:8000"
    environment:
      - INNGEST_BASE_URL=http://inngest-dev:8288
      - DATABASE_URL=${DATABASE_URL}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - HF_TOKEN=${HF_TOKEN}
      - R2_ENDPOINT=${R2_ENDPOINT}
      - R2_ACCESS_KEY_ID=${R2_ACCESS_KEY_ID}
      - R2_SECRET_ACCESS_KEY=${R2_SECRET_ACCESS_KEY}
      - R2_BUCKET=${R2_BUCKET}
    depends_on:
      - inngest-dev
    volumes:
      - ./apps/api:/app
      - ./packages:/packages
    command: uvicorn main:app --host 0.0.0.0 --port 8000 --reload

volumes:
  inngest_data:
